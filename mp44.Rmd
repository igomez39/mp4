---
title: "Mini Project 4"
author: "Felicia Curtis, Stephanie Foukaris, and Isabel Gomez"
date: "April 25, 2018"
output: 
  html_document:
    code_folding: hide
---
#*DREAMWORKS* Is the Dream Equal for All

## Question: Does the company "DREAMWORKS" use an equal number of men and women in their top 5 films from 2010 to 2017?

```{r, message=FALSE, warning=FALSE, include=TRUE}
library(tidyverse)
library(mdsr)
library(RMySQL)
db <- dbConnect_scidb(dbname = "imdb")
```

#The first step is to find the code number for dreamworks.

```{r, message=FALSE, warning=FALSE, include=TRUE}
db %>%
  dbGetQuery(" SELECT * 
FROM company_name
WHERE name = 'Dreamworks';")
``` 

#Then using this information, we found all of the movies produced by Dreamworks. We did this by using movie_companies and joining it with the table 'titles' Because we are only looking for movies, we select kind_id =1 and the production year to be 2010 or later. 

```{r, message= FALSE, warning=FALSE, include= TRUE}
db %>%
  dbGetQuery("SELECT *
  FROM movie_companies AS mc
  JOIN title AS t ON t.id = mc.movie_id
  JOIN cast_info AS ci ON ci.movie_id = mc.movie_id
 JOIN movie_info AS mi ON mi.movie_id = mc.movie_id
  WHERE company_id = '10667' 
  AND mi.info_type_id = '108'
  AND kind_id = '1' 
  AND production_year >= 2010
  AND (ci.role_id = '1' OR ci.role_id = '2')
  ORDER BY info DESC
  LIMIT 0, 5;")
```

#This query filters out all the opening weekends in countries outside of the United States, additionally, it has the amount of money earned during opening weekend in descending order
```{r, include=TRUE, warning=FALSE, message=FALSE}
db %>%
  dbGetQuery("SELECT * FROM imdb.movie_companies AS mc
  JOIN title AS t ON t.id = mc.movie_id
  JOIN cast_info AS ci ON ci.movie_id = mc.movie_id
JOIN movie_info AS mi ON mi.movie_id = mc.movie_id
  WHERE company_id = '10667' 
  AND mi.info_type_id = '108'
  AND kind_id = '1' 
  AND production_year >= 2010
  AND (ci.role_id = '1' OR ci.role_id = '2')
  AND INSTR(info, 'USA')
  AND ci.note IS NOT NULL
  ORDER BY info DESC 
  LIMIT 0, 5;")
```
#This query simplifies the data we're asking for, so it only incorporates the necessary information. Additionally, we have attempted to count the number of actresses and actors in each movie. 

```{r, message=FALSE, warning=FALSE, include=TRUE}
db %>%
dbGetQuery("SELECT title, production_year, ci.note, ci.role_id, mi.info, COUNT(role_id) FROM movie_companies AS mc
  JOIN title AS t ON t.id = mc.movie_id
  JOIN cast_info AS ci ON ci.movie_id = mc.movie_id
JOIN movie_info AS mi ON mi.movie_id = mc.movie_id
WHERE company_id = '10667'
AND mi.info_type_id = '108'
  AND kind_id = '1' 
  AND production_year >= 2010
  AND (ci.role_id = '1' OR ci.role_id = '2')
  AND INSTR(info, 'USA')
  AND ci.note IS NOT NULL
  AND NOT INSTR(ci.note,'uncredited')
  GROUP BY title, role_id
  ORDER BY info ;")
```

#THIS IS WHAT WE NEED (STUFF ABOVE IS OLD)

#We need to find a way to convert the info column into a numeric value so that the order will actually be by how much money each movie made. Until I get that sorted out, we can simply graph the most recent films (or maybe all). Here is the information based on year instead. 

Created a dataframe called Dataset_Dreamworks

```{r, include=TRUE, warning=FALSE, message=FALSE}
Dataset_Dreamworks <- db %>%
dbGetQuery("SELECT title, production_year, ci.note, ci.role_id, mi.info, COUNT(role_id) 
FROM movie_companies AS mc
  JOIN title AS t ON t.id = mc.movie_id
  JOIN cast_info AS ci ON ci.movie_id = mc.movie_id
JOIN movie_info AS mi ON mi.movie_id = mc.movie_id
WHERE company_id = '10667'
AND mi.info_type_id = '108'
  AND kind_id = '1' 
  AND production_year >= 1996
  AND (ci.role_id = '1' OR ci.role_id = '2')
  AND INSTR(info, 'USA')
  AND ci.note IS NOT NULL
  AND NOT INSTR(ci.note,'uncredited')
  GROUP BY title, role_id
  ORDER BY production_year DESC
 ;")
```

Changed column name(ggplot didn't like the previous name)
```{r}
Dataset_Dreamworks <- Dataset_Dreamworks %>%
  rename(count_cast = `COUNT(role_id)`)%>%
  rename(Gender = `role_id`)
```

PLOT
```{r}
gender_differences <- ggplot(data=Dataset_Dreamworks, aes(y=count_cast, x=production_year)) +
  geom_point(aes(color=factor(Gender)))+
  labs(x= "Production Year", y= "Number of Actors/Actresses in Cast", title = "Gender Gap in Top Movies from Dreamwork Productions")+
  theme_igray()

gender_differences + scale_colour_manual(values = c("blue", "red"))
```



```{r}
title = c("Cowboys & Aliens", "Little Fockers", "Real Steel", "Anchorman 2", "The Help")
gender = c("M","M","M","M","M","F","F","F","F","F")
cast_count = c(5,9,2,7,0,1,5,0,1,4)
Dreamworks_5 = data.frame(title, cast_count, gender)
```



```{r}
ggplot(data = Dreamworks_5, mapping = aes(x = title, y = cast_count, fill=factor(gender))) + 
  geom_col() +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 15), labels = scales::comma) +
    labs(
    title = "Top Five Films (2010-2017) - Opening Day",
    subtitle = "Dreamworks",
    caption = "Source: IMDB",
    x = "Title",
    y = "Actor/Actress Count"
    )
  
```
